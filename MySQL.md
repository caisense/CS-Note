# MySQL

## 索引

### 最左前缀匹配原则

最左优先，以最左边的为起点任何连续的索引都能匹配上。同时遇到范围查询(>、<、between、like)就会停止匹配。（注意是索引顺序的最左，与查询条件的顺序无关，因为优化器能调整条件的顺序）

例如：

1. 如果建立(a,b)顺序的索引，我们的条件只有b=xxx，是匹配不到(a,b)索引的；
2. 若查询条件是a = 1 and b = 2或者b=2 and a=1就可以，因为优化器会自动调整a,b的顺序，并不需要严格按照索引的顺序来；
3. 如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，因为c字段是一个范围查询，它之后的字段会停止匹配。而索引(a,b,d,c)能被用到，因为范围查询的c列在索引的最后，且条件a、b、c的顺序能任意调整


#### 原理

索引的底层是一颗B+树，那么联合索引也还是一颗B+树，只不过联合索引的健值数量不是一个，而是多个。构建一颗B+树只能根据一个值来构建，因此数据库依据联合索引最左的字段来构建B+树。

例如联合索引(a,b)的B+树：

<img src="D:\CS-Note\images\最左前缀匹配B+树.png" width="500px">

先按a值排序，当a值相等时，才按b值排序。因此当a用范围查询时，b是无序的，无法使用索引，即索引某列是**范围查询**时，其右侧的列无法使用索引。

 

#### 注意

只是MySQL有这个限制，Oracle任意顺序都可以



## 存储引擎

InnoDB是MySQL 默认的事务型存储引擎

与 MyISAM比较：

|                  | InnoDB             | MyISAM                |
| ---------------- | ------------------ | --------------------- |
| 事务             | 支持               | 不支持                |
| 外键             | 支持               | 不                    |
| 主键（唯一索引） | 必须有             | 可以没有              |
| 索引             | 聚簇索引           | 非聚簇索引            |
| count            | 不保存表具体行数   | 用一个变量保存        |
| 日志             | redo log           | 没有                  |
| 锁               | 表锁和行锁         | 只有表锁              |
| 存储文件         | 表定义frm、数据ibd | frm、数据myd、myi索引 |