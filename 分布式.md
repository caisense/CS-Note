# 分布式定时任务

## 1.单机定时任务

sprintboot的@Scheduled注解，使用cron表达式表示定时任务周期

缺点：

- 功能相对简单，可用性差；部署效率低，开发和维护成本高，不方便管理和控制，尤其在多系统的环境；
- 任务跟踪和告警难以实现。

## 2.分布式定时任务

运行在分布式集群环境下的调度任务，同⼀个定时任务程序**部署多份**，则同一时刻应当只允许⼀个定时任务执行。

优点：

- 集群的方式进行管理调度，更高效，降低开发和维护成本
- 分布式部署，保证系统高可用性，伸缩性，负载均衡，提高容错；
- 任务可持久化到库，并有完善的重做机制、任务跟踪和告警。

# 分布式锁

# 分布式ID

在开发中，我们通常会需要一个唯一ID来标识数据，如果是单体架构，我们可以通过数据库的主键，或直接在内存中维护一个自增数字来作为ID都是可以的，但对于一个分布式系统，就会有可能会出现ID冲突，此时有以下解决方案：

1. uuid，这种方案复杂度最低，但是会影响存储空间和性能
2. 利用单机数据库的自增主键，作为分布式ID的生成器，复杂度适中，ID长度较之uuid更短，但是受到单机数据库性能的限制，并发量大的时候，此方案也不是最优方案
3. 利用redis、zookeeper的特性来生成id，比如redis的自增命令、zookeeper的顺序节点，这种方案和单机数据库(mysql)相比，性能有所提高，可以适当选用
4. 雪花算法，一切问题如果能直接用算法解决，那就是最合适的，利用雪花算法也可以生成分布式ID，底层原理就是通过某台机器在某一毫秒内对某一个数字自增，这种方案也能保证分布式架构中的系统id唯一，但是只能保证趋势递增。业界存在tinyid、leaf等开源中间件实现了雪花算法。