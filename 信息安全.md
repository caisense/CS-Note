信息安全

# 哈希算法

哈希算法（Hash）又称摘要算法（Digest），作用：对任意一组输入数据进行计算，得到一个固定长度的输出摘要。

哈希算法的目的就是为了验证原始数据是否被篡改。

**特点**

- 相同的输入一定得到相同的输出；
- 不同的输入大概率得到不同的输出。



**哈希碰撞**

两个不同的输入得到了**相同**的输出，碰撞是不可避免的，碰撞概率的高低关系到哈希算法的安全性。一个安全的哈希算法必须满足：

- 碰撞概率低；
- 不能猜测输出。

**常用哈希算法**

| 算法       | 输出长度（位） | 输出长度（字节） |
| :--------- | :------------- | :--------------- |
| MD5        | 128 bits       | 16 bytes         |
| SHA-1      | 160 bits       | 20 bytes         |
| RipeMD-160 | 160 bits       | 20 bytes         |
| SHA-256    | 256 bits       | 32 bytes         |
| SHA-512    | 512 bits       | 64 bytes         |

根据碰撞概率，哈希算法的**输出长度越长**，就越难产生碰撞，也就越安全。



## 用途

1. 验证数据、文件是否被篡改

   自己计算一下本地文件的哈希值，再与官网公开的哈希值对比，如果相同，说明文件下载正确，否则，说明文件已被篡改。

2. 存储用户口令

   如果直接将用户的原始口令存放到数据库中，会产生极大的安全风险：

   - 数据库管理员能够看到用户明文口令；
   - 数据库数据一旦泄漏，黑客即可获取用户明文口令。

   不存储用户的原始口令，那么如何对用户进行认证？方法是存储用户口令的哈希，例如，MD5。

   在用户输入原始口令后，系统计算用户输入的原始口令的MD5并与数据库存储的MD5对比，如果一致，说明口令正确，否则，口令错误。

   因此，数据库存储用户名和口令的表内容应该像下面这样：

   | username | password                         |
   | :------- | :------------------------------- |
   | bob      | f30aa7a662c728b7407c54ae6bfd27d1 |
   | alice    | 25d55ad283aa400af464c76d713c07ad |
   | tim      | bed128365216c019988915ed3add75fb |

   这样一来，数据库管理员看不到用户的原始口令。即使数据库泄漏，黑客也无法拿到用户的原始口令。想要拿到用户的原始口令，必须用暴力穷举的方法，一个口令一个口令地试，直到某个口令计算的MD5恰好等于指定值。

**彩虹表**

使用哈希口令时，还要注意防止**彩虹表**攻击。彩虹表就是常用口令的哈希表，如果用户使用了常用口令，黑客从MD5一下就能反查到原始口令

   | 常用口令 | MD5                              |
   | :------- | :------------------------------- |
   | hello123 | f30aa7a662c728b7407c54ae6bfd27d1 |
   | 12345678 | 25d55ad283aa400af464c76d713c07ad |
   | passw0rd | bed128365216c019988915ed3add75fb |
   | 19700101 | 570da6d5277a646f6552b8832012f5dc |
   | …        | …                                |
   | 20201231 | 6879c0ae9117b50074ce0a0d4c843060 |

**解决办法**

加盐（salt）：对每个口令额外添加随机数。目的在于使黑客的彩虹表失效，即使用户使用常用口令，也无法从MD5反推原始口令。

```
digest = md5(salt+inputPassword)
```

加盐处理后的数据库表：

| username | salt  | password                         |
| :------- | :---- | :------------------------------- |
| bob      | H1r0a | a5022319ff4c56955e22a74abcc2c210 |
| alice    | 7$p2w | e5de688c99e961ed6e560b972dab8b6a |
| tim      | z5Sk9 | 1eee304b92dc0d105904e7ab58fd2f64 |

java用信息摘要类MessageDigest计算哈希：

```java
public static void main(String[] args) throws Exception {
    // 创建一个MessageDigest实例，并指定使用的哈希算法:
    MessageDigest md = MessageDigest.getInstance("SHA-1");  // 支持常用哈希算法
    // 反复调用update输入数据:
    md.update("Hello".getBytes("UTF-8"));
    md.update("World".getBytes("UTF-8"));
    // 计算哈希
    byte[] result = md.digest(); // 20 bytes: db8ac1c259eb89d4a131b253bacfca5f319d54f2
    System.out.println(new BigInteger(1, result).toString(16));
}
```